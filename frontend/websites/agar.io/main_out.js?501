(function(g,r){function ya(){ia();setInterval(ia,18E4);z=$=document.getElementById("canvas");d=z.getContext("2d");z.onmousedown=function(a){if(ja){var b=a.clientX-(5+p/5/2),c=a.clientY-(5+p/5/2);if(Math.sqrt(b*b+c*c)<=p/5/2){G();A(17);return}}O=a.clientX;P=a.clientY;aa();G()};z.onmousemove=function(a){O=a.clientX;P=a.clientY;aa()};z.onmouseup=function(a){};var a=!1,b=!1,c=!1;g.onkeydown=function(e){32!=e.keyCode||a||(G(),A(17),a=!0);81!=e.keyCode||b||(A(18),b=!0);87!=e.keyCode||c||(G(),A(21),c=!0);27==e.keyCode&&r("#overlays").fadeIn(200)};g.onkeyup=function(e){32==e.keyCode&&(a=!1);87==e.keyCode&&(c=!1);81==e.keyCode&&b&&(A(19),b=!1)};g.onblur=function(){A(19);c=b=a=!1};g.onresize=ka;ka();g.requestAnimationFrame?g.requestAnimationFrame(la):setInterval(ba,1E3/60);setInterval(G,40);ma(r("#region").val());r("#overlays").show()}function za(){if(.5>h)H=null;else{for(var a=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,e=Number.NEGATIVE_INFINITY,d=0,f=0;f<q.length;f++)q[f].shouldRender()&&(d=Math.max(q[f].size,d),a=Math.min(q[f].x,a),b=Math.min(q[f].y,b),c=Math.max(q[f].x,c),e=Math.max(q[f].y,e));H=QUAD.init({minX:a-(d+100),minY:b-(d+100),maxX:c+(d+100),maxY:e+(d+100)});for(f=0;f<q.length;f++)if(a=q[f],a.shouldRender())for(b=0;b<a.points.length;++b)H.insert(a.points[b])}}function aa(){Q=(O-p/2)/h+s;R=(P-m/2)/h+t}function ia(){null==S&&(S={},r("#region").children().each(function(){var a=r(this),b=a.val();b&&(S[b]=a.text())}));r.get("http://m.agar.io/info",function(a){var b={},c;for(c in a.regions){var e=
c.split(":")[0];b[e]=b[e]||0;b[e]+=a.regions[c].numPlayers}for(c in b)r('#region option[value="'+c+'"]').text(S[c]+" ("+b[c]+" players)")},"json")}function na(){r("#adsBottom").hide();r("#overlays").hide()}function ma(a){a&&a!=I&&(I=a,ca())}function oa(){console.log("Find "+I+J);r.ajax("http://m.agar.io/",{error:function(){setTimeout(oa,1E3)},success:function(a){a=a.split("\n");pa("ws://"+a[0])},dataType:"text",method:"POST",cache:!1,crossDomain:!0,data:I+J||"?"})}function ca(){I&&(r("#connecting").show(),oa())}function pa(a){if(l){l.onopen=null;l.onmessage=null;l.onclose=null;try{l.close()}catch(b){}l=null}B=[];n=[];w={};q=[];C=[];y=[];x=u=null;D=0;console.log("Connecting to "+a);l=new WebSocket(a);l.binaryType="arraybuffer";l.onopen=Aa;l.onmessage=Ba;l.onclose=Ca;l.onerror=function(){console.log("socket error")}}function Aa(a){r("#connecting").hide();console.log("socket open");a=new ArrayBuffer(5);var b=new DataView(a);b.setUint8(0,254);b.setUint32(1,1,!0);l.send(a);a=new ArrayBuffer(5);b=new DataView(a);b.setUint8(0,255);b.setUint32(1,1,!0);l.send(a);qa()}function Ca(a){console.log("socket close");setTimeout(ca,500)}function Ba(a){function b(){for(var a="";;){var b=e.getUint16(c,!0);c+=2;if(0==b)break;a+=String.fromCharCode(b)}return a}var c=1,e=new DataView(a.data);switch(e.getUint8(0)){case 16:Da(e);break;case 17:K=e.getFloat32(1,!0);L=e.getFloat32(5,!0);M=e.getFloat32(9,!0);break;case 20:n=[];B=[];break;case 32:B.push(e.getUint32(1,!0));break;case 49:if(null!=u)break;a=e.getUint32(c,!0);c+=4;y=[];for(var d=0;d<a;++d){var f=e.getUint32(c,!0),c=c+4;y.push({id:f,name:b()})}ra();break;case 50:u=[];a=e.getUint32(c,!0);c+=4;for(d=0;d<a;++d)u.push(e.getFloat32(c,!0)),c+=4;ra();break;case 64:T=e.getFloat64(1,!0),U=e.getFloat64(9,!0),V=e.getFloat64(17,!0),W=e.getFloat64(25,!0),K=(V+T)/2,L=(W+U)/2,M=1,0==n.length&&(s=K,t=L,h=M)}}function Da(a){E=+new Date;var b=Math.random(),c=1;da=!1;for(var e=a.getUint16(c,!0),c=c+2,d=0;d<e;++d){var f=w[a.getUint32(c,!0)],g=w[a.getUint32(c+4,!0)],c=c+8;f&&g&&
(g.destroy(),g.ox=g.x,g.oy=g.y,g.oSize=g.size,g.nx=f.x,g.ny=f.y,g.nSize=g.size,g.updateTime=E)}for(;;){e=a.getUint32(c,!0);c+=4;if(0==e)break;for(var d=a.getFloat32(c,!0),c=c+4,f=a.getFloat32(c,!0),c=c+4,g=a.getFloat32(c,!0),c=c+4,h=a.getUint8(c++),l=a.getUint8(c++),p=a.getUint8(c++),h=(h<<16|l<<8|p).toString(16);6>h.length;)h="0"+h;var h="#"+h,m=a.getUint8(c++),l=!!(m&1),p=!!(m&16);m&2&&(c+=4);m&4&&(c+=8);m&8&&(c+=16);for(m="";;){var k=a.getUint16(c,!0),c=c+2;if(0==k)break;m+=String.fromCharCode(k)}k=null;w.hasOwnProperty(e)?(k=w[e],k.updatePos(),k.ox=k.x,k.oy=k.y,k.oSize=k.size,k.color=h):(k=new sa(e,d,f,g,h,m),k.pX=d,k.pY=f);k.isVirus=l;k.isAgitated=p;k.nx=d;k.ny=f;k.nSize=g;k.updateCode=b;k.updateTime=E;-1!=B.indexOf(e)&&-1==n.indexOf(k)&&(document.getElementById("overlays").style.display="none",n.push(k),1==n.length&&(s=k.x,t=k.y))}a.getUint16(c,!0);c+=2;f=a.getUint32(c,!0);c+=4;for(d=0;d<f;d++)e=a.getUint32(c,!0),c+=4,w[e]&&(w[e].updateCode=b);for(d=0;d<q.length;d++)q[d].updateCode!=b&&q[d--].destroy();da&&0==n.length&&r("#overlays").fadeIn(3E3)}function G(){if(ea()){var a=O-p/2,b=P-m/2;64>a*a+b*b||ta==Q&&ua==R||(ta=Q,ua=R,a=new ArrayBuffer(21),b=new DataView(a),b.setUint8(0,16),b.setFloat64(1,Q,!0),b.setFloat64(9,R,!0),b.setUint32(17,0,!0),l.send(a))}}function qa(){if(ea()&&null!=N){var a=new ArrayBuffer(1+2*N.length),b=new DataView(a);b.setUint8(0,0);for(var c=0;c<N.length;++c)b.setUint16(1+2*c,N.charCodeAt(c),!0);l.send(a)}}function ea(){return null!=l&&l.readyState==l.OPEN}function A(a){if(ea()){var b=new ArrayBuffer(1);(new DataView(b)).setUint8(0,a);l.send(b)}}function la(){ba();g.requestAnimationFrame(la)}function ka(){p=g.innerWidth;m=g.innerHeight;$.width=z.width=p;$.height=z.height=m;ba()}function Ea(){if(0!=n.length){for(var a=0,b=0;b<n.length;b++)a+=n[b].size;a=Math.pow(Math.min(64/a,1),.4)*Math.max(m/1080,p/1920);h=(9*h+a)/10}}function ba(){var a=+new Date;++Fa;E=+new Date;if(0<n.length){Ea();for(var b=0,c=0,e=0;e<n.length;e++)n[e].updatePos(),b+=n[e].x/n.length,c+=n[e].y/n.length;K=b;
L=c;M=h;s=(s+b)/2;t=(t+c)/2}else s=(29*s+K)/30,t=(29*t+L)/30,h=(9*h+M)/10;za();aa();d.clearRect(0,0,p,m);d.fillStyle=fa?"#111111":"#F2FBFF";d.fillRect(0,0,p,m);d.save();d.strokeStyle=fa?"#AAAAAA":"#000000";d.globalAlpha=.2;d.scale(h,h);b=p/h;c=m/h;for(e=-.5+(-s+b/2)%50;e<b;e+=50)d.beginPath(),d.moveTo(e,0),d.lineTo(e,c),d.stroke();for(e=-.5+(-t+c/2)%50;e<c;e+=50)d.beginPath(),d.moveTo(0,e),d.lineTo(b,e),d.stroke();d.restore();q.sort(function(a,b){return a.size==b.size?a.id-b.id:a.size-b.size});d.save();
d.translate(p/2,m/2);d.scale(h,h);d.translate(-s,-t);for(e=0;e<C.length;e++)C[e].draw();for(e=0;e<q.length;e++)q[e].draw();d.restore();x&&d.drawImage(x,p-x.width-10,10);D=Math.max(D,Ga());0!=D&&(null==X&&(X=new Y(24,"#FFFFFF")),X.setValue("Score: "+~~(D/100)),c=X.render(),b=c.width,d.globalAlpha=.2,d.fillStyle="#000000",d.fillRect(10,m-10-24-10,b+10,34),d.globalAlpha=1,d.drawImage(c,15,m-10-24-5));Ha();a=+new Date-a;a>1E3/60?v-=.01:a<1E3/65&&(v+=.01);.4>v&&(v=.4);1<v&&(v=1)}function Ha(){if(ja&&ga.width){var a=p/5;d.drawImage(ga,5,5,a,a)}}function Ga(){for(var a=0,b=0;b<n.length;b++)a+=n[b].nSize*n[b].nSize;return a}function ra(){x=null;if(null!=u||0!=y.length)if(null!=u||Z){x=document.createElement("canvas");var a=x.getContext("2d"),b=60,b=null==u?b+24*y.length:b+180,c=Math.min(200,.3*p)/200;x.width=200*c;x.height=b*c;a.scale(c,c);a.globalAlpha=.4;a.fillStyle="#000000";a.fillRect(0,0,200,b);a.globalAlpha=1;a.fillStyle="#FFFFFF";c=null;c="Leaderboard";a.font="30px Ubuntu";a.fillText(c,100-a.measureText(c).width/
2,40);if(null==u)for(a.font="20px Ubuntu",b=0;b<y.length;++b)c=y[b].name||"An unnamed cell",Z||(c="An unnamed cell"),-1!=B.indexOf(y[b].id)?(n[0].name&&(c=n[0].name),a.fillStyle="#FFAAAA"):a.fillStyle="#FFFFFF",c=b+1+". "+c,a.fillText(c,100-a.measureText(c).width/2,70+24*b);else for(b=c=0;b<u.length;++b)angEnd=c+u[b]*Math.PI*2,a.fillStyle=Ia[b+1],a.beginPath(),a.moveTo(100,140),a.arc(100,140,80,c,angEnd,!1),a.fill(),c=angEnd}}function sa(a,b,c,e,d,f){q.push(this);w[a]=this;this.id=a;this.ox=this.x=b;this.oy=this.y=c;this.oSize=this.size=e;this.color=d;this.points=[];this.pointsAcc=[];this.createPoints();this.setName(f)}function Y(a,b,c,e){a&&(this._size=a);b&&(this._color=b);this._stroke=!!c;e&&(this._strokeColor=e)}if("agar.io"!=g.location.hostname&&"localhost"!=g.location.hostname&&"10.10.2.13"!=g.location.hostname)g.location="http://agar.io/";else if(g.top!=g)g.top.location="http://agar.io/";else{var $,d,z,p,m,H=null,l=null,s=0,t=0,B=[],n=[],w={},q=[],C=[],y=[],O=0,P=0,Q=-1,R=-1,Fa=0,E=0,N=null,T=0,U=0,V=1E4,W=1E4,h=1,I=null,va=!0,Z=!0,ha=!1,da=!1,D=0,fa=!1,wa=!1,K=s=~~((T+V)/2),L=t=~~((U+W)/2),M=1,J="",u=null,Ia=["#333333","#FF3333","#33FF33","#3333FF"],ja="ontouchstart"in g&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ga=new Image;ga.src="img/split.png";var xa=document.createElement("canvas");if("undefined"==typeof console||"undefined"==typeof DataView||"undefined"==typeof WebSocket||null==xa||null==xa.getContext)alert("You browser might not support this game, we recommend you to use Chrome to play this"),
console={log:function(){},error:function(){},warn:function(){}};var S=null;g.setNick=function(a){na();N=a;qa();D=0};g.setRegion=ma;g.setSkins=function(a){va=a};g.setNames=function(a){Z=a};g.setDarkTheme=function(a){fa=a};g.setColors=function(a){ha=a};g.setShowMass=function(a){wa=a};g.spectate=function(){A(1);na()};g.setGameMode=function(a){a!=J&&(J=a,ca())};g.Raven&&g.Raven.config("https://2a85d1d3fb114384a2758cde7de2bef7@app.getsentry.com/43938",{release:"2",whitelistUrls:["agar.io/"]}).install();g.connect=pa;var ta=-1,ua=-1,x=null,v=1,X=null,F={},Ja="poland;usa;china;russia;canada;australia;spain;brazil;germany;ukraine;france;sweden;hitler;north korea;south korea;japan;united kingdom;earth;greece;latvia;lithuania;estonia;finland;norway;cia;maldivas;austria;nigeria;reddit;yaranaika;confederate;9gag;indiana;4chan;italy;ussr;bulgaria;tumblr;2ch.hk;hong kong;portugal;jamaica;german empire;mexico;sanik;switzerland;croatia;chile;indonesia;bangladesh;thailand;iran;iraq;peru;moon;botswana;bosnia;netherlands;european union;taiwan;pakistan;hungary;satanist;qing dynasty;nazi;matriarchy;patriarchy;feminism;ireland;texas;facepunch;prodota;cambodia;steam;piccolo;ea;india;kc;denmark;quebec;ayy lmao;sealand;bait;tsarist russia;origin;vinesauce;stalin;belgium;luxembourg;stussy;prussia;8ch;argentina;scotland;sir;romania;belarus;wojak;isis;doge;nasa;byzantium;imperial japan;french kingdom;somalia;turkey;mars;pokerface".split(";"),Ka=["m'blob"];sa.prototype={id:0,points:null,pointsAcc:null,name:null,nameCache:null,sizeCache:null,x:0,y:0,size:0,ox:0,oy:0,oSize:0,nx:0,ny:0,nSize:0,updateTime:0,updateCode:0,drawTime:0,destroyed:!1,isVirus:!1,isAgitated:!1,wasSimpleDrawing:!0,destroy:function(){var a;for(a=0;a<q.length;a++)if(q[a]==this){q.splice(a,1);break}delete w[this.id];a=n.indexOf(this);-1!=a&&(da=!0,n.splice(a,1));a=B.indexOf(this.id);-1!=a&&B.splice(a,1);this.destroyed=!0;C.push(this)},getNameSize:function(){return Math.max(~~(.3*this.size),24)},setName:function(a){if(this.name=a)null==this.nameCache?this.nameCache=new Y(this.getNameSize(),"#FFFFFF",!0,"#000000"):this.nameCache.setSize(this.getNameSize()),this.nameCache.setValue(this.name)},createPoints:function(){for(var a=this.getNumPoints();this.points.length>a;){var b=~~(Math.random()*this.points.length);this.points.splice(b,1);this.pointsAcc.splice(b,1)}0==this.points.length&&0<a&&(this.points.push({c:this,v:this.size,x:this.x,y:this.y}),this.pointsAcc.push(Math.random()-.5));for(;this.points.length<a;){var b=~~(Math.random()*this.points.length),c=this.points[b];this.points.splice(b,0,{c:this,v:c.v,x:c.x,y:c.y});this.pointsAcc.splice(b,0,this.pointsAcc[b])}},getNumPoints:function(){var a=10;20>this.size&&(a=5);this.isVirus&&(a=30);return~~Math.max(this.size*h*(this.isVirus?Math.min(2*v,1):v),a)},movePoints:function(){this.createPoints();for(var a=this.points,b=this.pointsAcc,c=b.concat(),e=a.concat(),d=e.length,f=0;f<d;++f){var g=c[(f-1+d)%d],h=c[(f+1)%d];b[f]+=(Math.random()-.5)*(this.isAgitated?3:1);b[f]*=.7;10<b[f]&&(b[f]=10);-10>b[f]&&(b[f]=-10);b[f]=(g+h+8*b[f])/10}for(var n=this,f=0;f<d;++f){c=e[f].v;g=e[(f-1+d)%d].v;h=e[(f+1)%d].v;if(15<this.size&&null!=H){var l=!1,m=a[f].x,k=a[f].y;H.retrieve2(m-5,k-5,10,10,function(a){a.c!=n&&25>(m-a.x)*(m-a.x)+(k-a.y)*(k-a.y)&&(l=!0)});!l&&(a[f].x<T||a[f].y<U||a[f].x>V||a[f].y>W)&&(l=!0);l&&(0<b[f]&&(b[f]=0),b[f]-=1)}c+=b[f];0>c&&(c=0);c=this.isAgitated?(19*c+this.size)/20:(12*c+this.size)/13;a[f].v=(g+h+8*c)/10;g=2*Math.PI/
d;h=this.points[f].v;this.isVirus&&0==f%2&&(h+=5);a[f].x=this.x+Math.cos(g*f)*h;a[f].y=this.y+Math.sin(g*f)*h}},updatePos:function(){var a;a=(E-this.updateTime)/120;a=0>a?0:1<a?1:a;a=a*a*(3-2*a);this.getNameSize();if(this.destroyed&&1<=a){var b=C.indexOf(this);-1!=b&&C.splice(b,1)}this.x=a*(this.nx-this.ox)+this.ox;this.y=a*(this.ny-this.oy)+this.oy;this.size=a*(this.nSize-this.oSize)+this.oSize;return a},shouldRender:function(){return this.x+this.size+40<s-p/2/h||this.y+this.size+40<t-m/2/h||this.x-
this.size-40>s+p/2/h||this.y-this.size-40>t+m/2/h?!1:!0},draw:function(){if(this.shouldRender()){var a=!this.isVirus&&!this.isAgitated&&.5>h;if(this.wasSimpleDrawing&&!a)for(var b=0;b<this.points.length;b++)this.points[b].v=this.size;this.wasSimpleDrawing=a;d.save();this.drawTime=E;b=this.updatePos();this.destroyed&&(d.globalAlpha*=1-b);d.lineWidth=10;d.lineCap="round";d.lineJoin=this.isVirus?"mitter":"round";ha?(d.fillStyle="#FFFFFF",d.strokeStyle="#AAAAAA"):(d.fillStyle=this.color,d.strokeStyle=this.color);if(a)d.beginPath(),d.arc(this.x,this.y,this.size,0,2*Math.PI,!1);else{this.movePoints();d.beginPath();var c=this.getNumPoints();d.moveTo(this.points[0].x,this.points[0].y);for(b=1;b<=c;++b){var e=b%c;d.lineTo(this.points[e].x,this.points[e].y)}}d.closePath();b=this.name.toLowerCase();!this.isAgitated&&va&&""==J?-1!=Ja.indexOf(b)?(F.hasOwnProperty(b)||(F[b]=new Image,F[b].src="skins/"+b+".png"),c=0!=F[b].width&&F[b].complete?F[b]:null):c=null:c=null;b=c?-1!=Ka.indexOf(b):!1;a||d.stroke();d.fill();null==c||b||(d.save(),d.clip(),d.drawImage(c,this.x-this.size,this.y-this.size,2*this.size,2*this.size),d.restore());(ha||15<this.size)&&!a&&(d.strokeStyle="#000000",d.globalAlpha*=.1,d.stroke());d.globalAlpha=1;null!=c&&b&&d.drawImage(c,this.x-2*this.size,this.y-2*this.size,4*this.size,4*this.size);c=-1!=n.indexOf(this);a=~~this.y;if((Z||c)&&this.name&&this.nameCache){e=this.nameCache;e.setValue(this.name);e.setSize(this.getNameSize());b=Math.ceil(10*h)/10;e.setScale(b);var e=e.render(),
g=~~(e.width/b),f=~~(e.height/b);d.drawImage(e,~~this.x-~~(g/2),a-~~(f/2),g,f);a+=e.height/2/b+4}wa&&c&&(null==this.sizeCache&&(this.sizeCache=new Y(this.getNameSize()/2,"#FFFFFF",!0,"#000000")),c=this.sizeCache,c.setSize(this.getNameSize()/2),c.setValue(~~(this.size*this.size/100)),b=Math.ceil(10*h)/10,c.setScale(b),e=c.render(),g=~~(e.width/b),f=~~(e.height/b),d.drawImage(e,~~this.x-~~(g/2),a-~~(f/2),g,f));d.restore()}}};Y.prototype={_value:"",_color:"#000000",_stroke:!1,_strokeColor:"#000000",
_size:16,_canvas:null,_ctx:null,_dirty:!1,_scale:1,setSize:function(a){this._size!=a&&(this._size=a,this._dirty=!0)},setScale:function(a){this._scale!=a&&(this._scale=a,this._dirty=!0)},setColor:function(a){this._color!=a&&(this._color=a,this._dirty=!0)},setStroke:function(a){this._stroke!=a&&(this._stroke=a,this._dirty=!0)},setStrokeColor:function(a){this._strokeColor!=a&&(this._strokeColor=a,this._dirty=!0)},setValue:function(a){a!=this._value&&(this._value=a,this._dirty=!0)},render:function(){null==this._canvas&&(this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"));if(this._dirty){this._dirty=!1;var a=this._canvas,b=this._ctx,c=this._value,e=this._scale,d=this._size,f=d+"px Ubuntu";b.font=f;var g=b.measureText(c).width,h=~~(.2*d);a.width=(g+6)*e;a.height=(d+h)*e;b.font=f;b.scale(e,e);b.globalAlpha=1;b.lineWidth=3;b.strokeStyle=this._strokeColor;b.fillStyle=this._color;this._stroke&&b.strokeText(c,3,d-h/2);b.fillText(c,3,d-h/2)}return this._canvas}};g.onload=ya}})(window,jQuery);