(function(g,u){function xa(){ga();setInterval(ga,18E4);A=V=document.getElementById("canvas");d=A.getContext("2d");A.onmousedown=function(a){if(ha){var b=a.clientX-(5+n/5/2),c=a.clientY-(5+n/5/2);if(Math.sqrt(b*b+c*c)<=n/5/2){F();B(17);return}}M=a.clientX;N=a.clientY;W();F()};A.onmousemove=function(a){M=a.clientX;N=a.clientY;W()};A.onmouseup=function(a){};var a=!1,b=!1,c=!1;g.onkeydown=function(e){32!=e.keyCode||a||(F(),B(17),a=!0);81!=e.keyCode||b||(B(18),b=!0);87!=e.keyCode||c||(F(),B(21),c=!0);27==e.keyCode&&u("#overlays").fadeIn(200)};g.onkeyup=function(e){32==e.keyCode&&(a=!1);87==e.keyCode&&(c=!1);81==e.keyCode&&b&&(B(19),b=!1)};g.onblur=function(){B(19);c=b=a=!1};g.onresize=ia;ia();g.requestAnimationFrame?g.requestAnimationFrame(ja):setInterval(X,1E3/60);setInterval(F,100);ka(u("#region").val())}function ya(){if(.25>k)G=null;else{for(var a=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,e=Number.NEGATIVE_INFINITY,d=0,f=0;f<r.length;f++)r[f].shouldRender()&&(d=Math.max(r[f].size,d),a=Math.min(r[f].x,a),b=Math.min(r[f].y,b),c=Math.max(r[f].x,c),e=Math.max(r[f].y,e));G=QUAD.init({minX:a-(d+100),minY:b-(d+100),maxX:c+(d+100),maxY:e+(d+100)});for(f=0;f<r.length;f++)if(a=r[f],a.shouldRender())for(b=0;b<a.points.length;++b)G.insert(a.points[b])}}function W(){O=(M-n/2)/k+w;P=(N-t/2)/k+x}function ga(){null==Q&&(Q={},u("#region").children().each(function(){var a=u(this),b=a.val();b&&(Q[b]=a.text())}));u.get("http://m.agar.io/info",function(a){for(var b in a.regions)u('#region option[value="'+
b+'"]').text(Q[b]+" ("+a.regions[b].numPlayers+" players)")},"json")}function la(){u("#adsBottom").hide();u("#overlays").hide()}function ka(a){a&&a!=Y&&(Y=a,ma())}function na(){u.ajax("http://m.agar.io/",{error:function(){setTimeout(na,1E3)},success:function(a){a=a.split("\n");oa("ws://"+a[0])},dataType:"text",method:"POST",cache:!1,crossDomain:!0,data:Y||"?"})}function ma(){u("#connecting").show();na()}function oa(a){m&&(m.onopen=null,m.onmessage=null,m.onclose=null,m.close(),m=null);C=[];p=[];y={};r=[];D=[];q=[];console.log("Connecting to "+a);m=new WebSocket(a);m.binaryType="arraybuffer";m.onopen=za;m.onmessage=Aa;m.onclose=Ba;m.onerror=function(){console.log("socket error")}}function za(a){u("#connecting").hide();console.log("socket open");a=new ArrayBuffer(5);var b=new DataView(a);b.setUint8(0,255);b.setUint32(1,1,!0);m.send(a);pa()}function Ba(a){console.log("socket close");setTimeout(ma,500)}function Aa(a){function b(){for(var a="";;){var b=e.getUint16(c,!0);c+=2;if(0==b)break;a+=String.fromCharCode(b)}return a}
var c=1,e=new DataView(a.data);switch(e.getUint8(0)){case 16:Ca(e);break;case 17:H=e.getFloat64(1,!0);I=e.getFloat64(9,!0);J=e.getFloat64(17,!0);break;case 20:p=[];C=[];break;case 32:C.push(e.getUint32(1,!0));break;case 48:for(q=[];c<e.byteLength;)q.push({id:0,name:b()});qa();break;case 49:a=e.getUint32(c,!0);c+=4;q=[];for(var d=0;d<a;++d){var f=e.getUint32(c,!0),c=c+4;q.push({id:f,name:b()})}qa();break;case 64:Z=e.getFloat64(1,!0),$=e.getFloat64(9,!0),aa=e.getFloat64(17,!0),ba=e.getFloat64(25,!0),H=(aa+Z)/2,I=(ba+$)/2,J=1,0==p.length&&(w=H,x=I,k=J)}}function Ca(a){E=+new Date;var b=Math.random(),c=1;ca=!1;for(var e=a.getUint16(c,!0),c=c+2,d=0;d<e;++d){var f=y[a.getUint32(c,!0)],g=y[a.getUint32(c+4,!0)],c=c+8;f&&g&&(g.destroy(),g.ox=g.x,g.oy=g.y,g.oSize=g.size,g.nx=f.x,g.ny=f.y,g.nSize=g.size,g.updateTime=E)}for(;;){e=a.getUint32(c,!0);c+=4;if(0==e)break;var d=a.getFloat64(c,!0),c=c+8,f=a.getFloat64(c,!0),c=c+8,g=a.getFloat64(c,!0),c=c+8,h=a.getUint8(c++),m=!1;if(0==h)m=!0,h="#33FF33";else if(255==
h){var m=a.getUint8(c++),h=a.getUint8(c++),k=a.getUint8(c++),h=ra(m<<16|h<<8|k),k=a.getUint8(c++),m=!!(k&1);k&2&&(c+=4);k&4&&(c+=8);k&8&&(c+=16)}else{var h=63487|h<<16,l=(h>>16&255)/255*360,n=(h>>8&255)/255,h=(h>>0&255)/255;if(0==n)h=h<<16|h<<8|h<<0;else{var l=l/60,k=~~l,v=l-k,l=h*(1-n),t=h*(1-n*v),n=h*(1-n*(1-v)),q=v=0,s=0;switch(k%6){case 0:v=h;q=n;s=l;break;case 1:v=t;q=h;s=l;break;case 2:v=l;q=h;s=n;break;case 3:v=l;q=t;s=h;break;case 4:v=n;q=l;s=h;break;case 5:v=h,q=l,s=t}v=~~(255*v)&255;q=~~(255*
q)&255;s=~~(255*s)&255;h=v<<16|q<<8|s}h=ra(h)}for(k="";;){l=a.getUint16(c,!0);c+=2;if(0==l)break;k+=String.fromCharCode(l)}l=null;y.hasOwnProperty(e)?(l=y[e],l.updatePos(),l.ox=l.x,l.oy=l.y,l.oSize=l.size,l.color=h):(l=new sa(e,d,f,g,h,m,k),l.pX=d,l.pY=f);l.nx=d;l.ny=f;l.nSize=g;l.updateCode=b;l.updateTime=E;-1!=C.indexOf(e)&&-1==p.indexOf(l)&&(document.getElementById("overlays").style.display="none",p.push(l),1==p.length&&(w=l.x,x=l.y))}a.getUint16(c,!0);c+=2;f=a.getUint32(c,!0);c+=4;for(d=0;d<f;d++)e=a.getUint32(c,!0),c+=4,y[e]&&(y[e].updateCode=b);for(d=0;d<r.length;d++)r[d].updateCode!=b&&r[d--].destroy();ca&&0==p.length&&u("#overlays").fadeIn(3E3)}function F(){if(null!=m&&m.readyState==m.OPEN){var a=M-n/2,b=N-t/2;64>a*a+b*b||ta==O&&ua==P||(ta=O,ua=P,a=new ArrayBuffer(21),b=new DataView(a),b.setUint8(0,16),b.setFloat64(1,O,!0),b.setFloat64(9,P,!0),b.setUint32(17,0,!0),m.send(a))}}function pa(){if(null!=m&&m.readyState==m.OPEN&&null!=K){var a=new ArrayBuffer(1+2*K.length),b=new DataView(a);b.setUint8(0,0);for(var c=0;c<K.length;++c)b.setUint16(1+2*c,K.charCodeAt(c),!0);m.send(a)}}function B(a){if(null!=m&&m.readyState==m.OPEN){var b=new ArrayBuffer(1);(new DataView(b)).setUint8(0,a);m.send(b)}}function ja(){X();g.requestAnimationFrame(ja)}function ia(){n=g.innerWidth;t=g.innerHeight;V.width=A.width=n;V.height=A.height=t;X()}function Da(){if(0!=p.length){for(var a=0,b=0;b<p.length;b++)a+=p[b].size;a=Math.pow(Math.min(64/a,1),.4)*Math.max(t/965,n/1920);k=(9*k+a)/10}}function X(){var a=+new Date;++Ea;
E=+new Date;if(0<p.length){Da();for(var b=0,c=0,e=0;e<p.length;e++)p[e].updatePos(),b+=p[e].x/p.length,c+=p[e].y/p.length;H=b;I=c;J=k;w=(w+b)/2;x=(x+c)/2}else w=(29*w+H)/30,x=(29*x+I)/30,k=(9*k+J)/10;ya();W();d.clearRect(0,0,n,t);d.fillStyle=da?"#111111":"#F2FBFF";d.fillRect(0,0,n,t);d.save();d.strokeStyle=da?"#AAAAAA":"#000000";d.globalAlpha=.2;d.scale(k,k);b=n/k;c=t/k;for(e=-.5+(-w+b/2)%50;e<b;e+=50)d.beginPath(),d.moveTo(e,0),d.lineTo(e,c),d.stroke();for(e=-.5+(-x+c/2)%50;e<c;e+=50)d.beginPath(),
d.moveTo(0,e),d.lineTo(b,e),d.stroke();d.restore();r.sort(function(a,b){return a.size==b.size?a.id-b.id:a.size-b.size});d.save();d.translate(n/2,t/2);d.scale(k,k);d.translate(-w,-x);for(e=0;e<D.length;e++)D[e].draw();for(e=0;e<r.length;e++)r[e].draw();d.restore();z&&0!=q.length&&d.drawImage(z,n-z.width-10,10);L=Math.max(L,Fa());0!=L&&(null==R&&(R=new S(24,"#FFFFFF")),R.setValue("Score: "+~~(L/100)),c=R.render(),b=c.width,d.globalAlpha=.2,d.fillStyle="#000000",d.fillRect(10,t-10-24-10,b+10,34),d.globalAlpha=1,d.drawImage(c,15,t-10-24-5));Ga();a=+new Date-a;a>1E3/60?s-=.01:a<1E3/65&&(s+=.01);.4>s&&(s=.4);1<s&&(s=1)}function Ga(){if(ha&&ea.width){var a=n/5;d.drawImage(ea,5,5,a,a)}}function Fa(){for(var a=0,b=0;b<p.length;b++)a+=p[b].nSize*p[b].nSize;return a}function qa(){if(0!=q.length)if(T){z=document.createElement("canvas");var a=z.getContext("2d"),b=60+24*q.length,c=Math.min(200,.3*n)/200;z.width=200*c;z.height=b*c;a.scale(c,c);a.globalAlpha=.4;a.fillStyle="#000000";a.fillRect(0,0,200,b);a.globalAlpha=
1;a.fillStyle="#FFFFFF";c=null;c="Leaderboard";a.font="30px Ubuntu";a.fillText(c,100-a.measureText(c).width/2,40);a.font="20px Ubuntu";for(b=0;b<q.length;++b)c=q[b].name||"An unnamed cell",T||(c="An unnamed cell"),-1!=C.indexOf(q[b].id)?(p[0].name&&(c=p[0].name),a.fillStyle="#FFAAAA"):a.fillStyle="#FFFFFF",c=b+1+". "+c,a.fillText(c,100-a.measureText(c).width/2,70+24*b)}else z=null}function sa(a,b,c,e,d,f,g){r.push(this);y[a]=this;this.id=a;this.ox=this.x=b;this.oy=this.y=c;this.oSize=this.size=e;this.color=d;this.isVirus=f;this.points=[];this.pointsAcc=[];this.createPoints();this.setName(g)}function ra(a){for(a=a.toString(16);6>a.length;)a="0"+a;return"#"+a}function S(a,b,c,e){a&&(this._size=a);b&&(this._color=b);this._stroke=!!c;e&&(this._strokeColor=e)}if("agar.io"!=g.location.hostname&&"localhost"!=g.location.hostname&&"10.10.2.13"!=g.location.hostname)g.location="http://agar.io/";else if(g.top!=g)g.top.location="http://agar.io/";else{var V,d,A,n,t,G=null,m=null,w=0,x=0,C=[],p=[],y={},r=[],D=[],q=[],M=0,N=0,O=-1,P=-1,Ea=0,E=0,K=null,Z=0,$=0,aa=1E4,ba=1E4,k=1,Y=null,va=!0,T=!0,fa=!1,ca=!1,L=0,da=!1,wa=!1,H=0,I=0,J=1,ha="ontouchstart"in g&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ea=new Image;ea.src="img/split.png";var Q=null;g.setNick=function(a){la();K=a;pa();L=0};g.setRegion=ka;g.setSkins=function(a){va=a};g.setNames=function(a){T=a};g.setDarkTheme=function(a){da=a};g.setColors=function(a){fa=a};g.setShowMass=function(a){wa=a};g.spectate=function(){B(1);la()};g.connect=oa;var ta=-1,ua=-1,z=null,s=1,R=null,U={},Ha="poland;usa;china;russia;canada;australia;spain;brazil;germany;ukraine;france;sweden;hitler;north korea;south korea;japan;united kingdom;earth;greece;latvia;lithuania;estonia;finland;norway;cia;maldivas;austria;nigeria;reddit;yaranaika;confederate;9gag;indiana;4chan;italy;ussr;pewdiepie;bulgaria;tumblr;2ch.hk;hong kong;portugal;jamaica;german empire;mexico;sanik;switzerland;croatia;chile;indonesia;bangladesh;thailand;iran;iraq;peru;moon;botswana;bosnia;netherlands;european union;taiwan;pakistan;hungary;satanist;qing dynasty;nazi;matriarchy;patriarchy;feminism;ireland;texas;facepunch;prodota;cambodia;steam;piccolo;ea;india;kc;denmark;quebec;ayy lmao;sealand;bait;tsarist russia;origin;vinesauce;stalin;belgium;luxembourg;stussy;prussia;8ch;argentina;scotland;sir;romania;belarus;wojak;isis;doge".split(";"),Ia=["m'blob"];sa.prototype={id:0,points:null,pointsAcc:null,name:null,nameCache:null,sizeCache:null,x:0,y:0,size:0,ox:0,oy:0,oSize:0,nx:0,ny:0,nSize:0,updateTime:0,updateCode:0,drawTime:0,destroyed:!1,isVirus:!1,destroy:function(){var a;for(a=0;a<r.length;a++)if(r[a]==this){r.splice(a,1);break}delete y[this.id];a=p.indexOf(this);-1!=a&&(ca=!0,p.splice(a,1));a=C.indexOf(this.id);-1!=a&&C.splice(a,1);this.destroyed=!0;D.push(this)},getNameSize:function(){return Math.max(~~(.3*this.size),24)},setName:function(a){if(this.name=a)null==this.nameCache?this.nameCache=new S(this.getNameSize(),"#FFFFFF",!0,"#000000"):this.nameCache.setSize(this.getNameSize()),this.nameCache.setValue(this.name)},createPoints:function(){for(var a=this.getNumPoints();this.points.length>a;){var b=~~(Math.random()*this.points.length);this.points.splice(b,1);this.pointsAcc.splice(b,1)}0==this.points.length&&0<a&&(this.points.push({c:this,v:this.size,x:this.x,y:this.y}),this.pointsAcc.push(Math.random()-.5));for(;this.points.length<a;){var b=~~(Math.random()*this.points.length),c=this.points[b];this.points.splice(b,0,{c:this,v:c.v,x:c.x,y:c.y});this.pointsAcc.splice(b,0,this.pointsAcc[b])}},getNumPoints:function(){var a=10;20>this.size&&(a=5);this.isVirus&&(a=30);return~~Math.max(this.size*k*(this.isVirus?Math.min(2*s,1):s),a)},movePoints:function(){this.createPoints();for(var a=this.points,b=this.pointsAcc,c=b.concat(),e=a.concat(),d=e.length,f=0;f<d;++f){var g=c[(f-1+d)%d],h=c[(f+1)%d];b[f]+=Math.random()-.5;b[f]*=.7;10<b[f]&&(b[f]=10);-10>b[f]&&(b[f]=-10);b[f]=(g+h+8*b[f])/10}for(var k=this,f=0;f<d;++f){c=e[f].v;g=e[(f-1+d)%d].v;h=e[(f+1)%d].v;if(15<this.size&&null!=G){var m=!1,l=a[f].x,n=a[f].y;G.retrieve2(l-5,n-5,10,10,function(a){a.c!=k&&25>(l-a.x)*(l-a.x)+(n-a.y)*(n-a.y)&&(m=!0)});!m&&(a[f].x<Z||a[f].y<$||a[f].x>aa||a[f].y>ba)&&(m=!0);m&&(0<b[f]&&(b[f]=0),b[f]-=1)}c+=b[f];0>c&&(c=0);c=(12*c+this.size)/13;a[f].v=(g+h+8*c)/10;g=2*Math.PI/d;h=this.points[f].v;this.isVirus&&0==f%2&&(h+=5);a[f].x=this.x+Math.cos(g*f)*h;a[f].y=this.y+Math.sin(g*
f)*h}},updatePos:function(){var a;a=(E-this.updateTime)/120;a=0>a?0:1<a?1:a;a=a*a*(3-2*a);this.getNameSize();if(this.destroyed&&1<=a){var b=D.indexOf(this);-1!=b&&D.splice(b,1)}this.x=a*(this.nx-this.ox)+this.ox;this.y=a*(this.ny-this.oy)+this.oy;this.size=a*(this.nSize-this.oSize)+this.oSize;return a},shouldRender:function(){return this.x+this.size+40<w-n/2/k||this.y+this.size+40<x-t/2/k||this.x-this.size-40>w+n/2/k||this.y-this.size-40>x+t/2/k?!1:!0},draw:function(){if(this.shouldRender()){var a=
!this.isVirus&&.5>k;d.save();this.drawTime=E;var b=this.updatePos();this.destroyed&&(d.globalAlpha*=1-b);d.lineWidth=10;d.lineCap="round";d.lineJoin=this.isVirus?"mitter":"round";fa?(d.fillStyle="#FFFFFF",d.strokeStyle="#AAAAAA"):(d.fillStyle=this.color,d.strokeStyle=this.color);if(a)d.beginPath(),d.arc(this.x,this.y,this.size,0,2*Math.PI,!1);else for(this.movePoints(),d.beginPath(),a=this.getNumPoints(),d.moveTo(this.points[0].x,this.points[0].y),b=1;b<=a;++b){var c=b%a;d.lineTo(this.points[c].x,this.points[c].y)}d.closePath();a=this.name.toLowerCase();va?-1!=Ha.indexOf(a)?(U.hasOwnProperty(a)||(U[a]=new Image,U[a].src="skins/"+a+".png"),b=U[a]):b=null:b=null;a=b?-1!=Ia.indexOf(a):!1;d.stroke();d.fill();null!=b&&0<b.width&&!a&&(d.save(),d.clip(),d.drawImage(b,this.x-this.size,this.y-this.size,2*this.size,2*this.size),d.restore());if(fa||15<this.size)d.strokeStyle="#000000",d.globalAlpha*=.1,d.stroke();d.globalAlpha=1;null!=b&&0<b.width&&a&&d.drawImage(b,this.x-2*this.size,this.y-2*this.size,4*this.size,4*this.size);b=-1!=p.indexOf(this);a=~~this.y;if((T||b)&&this.name&&this.nameCache){var e=this.nameCache;e.setValue(this.name);e.setSize(this.getNameSize());c=Math.ceil(10*k)/10;e.setScale(c);var e=e.render(),g=~~(e.width/c),c=~~(e.height/c);d.drawImage(e,~~this.x-~~(g/2),a-~~(c/2),g,c);a+=e.height/2+4}wa&&b&&(null==this.sizeCache&&(this.sizeCache=new S(this.getNameSize()/2,"#FFFFFF",!0,"#000000")),b=this.sizeCache,b.setSize(this.getNameSize()/2),b.setValue(~~(this.size*this.size/100)),
c=Math.ceil(10*k)/10,b.setScale(c),e=b.render(),g=~~(e.width/c),c=~~(e.height/c),d.drawImage(e,~~this.x-~~(g/2),a-~~(c/2),g,c));d.restore()}}};S.prototype={_value:"",_color:"#000000",_stroke:!1,_strokeColor:"#000000",_size:16,_canvas:null,_ctx:null,_dirty:!1,_scale:1,setSize:function(a){this._size!=a&&(this._size=a,this._dirty=!0)},setScale:function(a){this._scale!=a&&(this._scale=a,this._dirty=!0)},setColor:function(a){this._color!=a&&(this._color=a,this._dirty=!0)},setStroke:function(a){this._stroke!=
a&&(this._stroke=a,this._dirty=!0)},setStrokeColor:function(a){this._strokeColor!=a&&(this._strokeColor=a,this._dirty=!0)},setValue:function(a){a!=this._value&&(this._value=a,this._dirty=!0)},render:function(){null==this._canvas&&(this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"));if(this._dirty){var a=this._canvas,b=this._ctx,c=this._value,d=this._scale,g=this._size,f=g+"px Ubuntu";b.font=f;var k=b.measureText(c).width,h=~~(.2*g);a.width=(k+6)*d;a.height=(g+h)*d;b.font=f;b.scale(d,d);b.globalAlpha=1;b.lineWidth=3;b.strokeStyle=this._strokeColor;b.fillStyle=this._color;this._stroke&&b.strokeText(c,3,g-h/2);b.fillText(c,3,g-h/2)}return this._canvas}};g.onload=xa}})(window,jQuery);